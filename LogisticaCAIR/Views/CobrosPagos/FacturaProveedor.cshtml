@model LogisticaCAIR.Models.FacturasProveedore
@{
    ViewData["Title"] = "Factura de proveedores";
}
<h1>Factura de proveedores</h1>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<link href="~/css/StyleSheetTables.css" type="text/css" rel="stylesheet" />
<div class="container table table-borderless table-responsive" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
    <form class="active container-fluid table table-bordered" asp-action="PagoProveedores">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpFechaInicio" class="control-label" style="font-family:'Comic Sans MS';">Fecha de inicio</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           asp-format="{0:dd/MM/yyyy}" type="date" asp-for="FpFechaInicio" />
                    <span asp-validation-for="FpFechaInicio" class="text-danger"></span>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpFechaVencimiento" class="control-label" style="font-family:'Comic Sans MS';"> Fecha de vencimiento</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;"
                           asp-for="FpFechaVencimiento" class="form-control" asp-format="{0:dd/MM/yyyy}" type="date" />
                    <span asp-validation-for="FpFechaVencimiento" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Número de pedimento</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           asp-for="FpPedimento" type="number" id="NumComp" />
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpNumFactProv" class="control-label" style="font-family:'Comic Sans MS';">Número de factura de proveedor</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpNumFactProv" class="form-control" />
                    <span asp-validation-for="FpNumFactProv" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Número de caja</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           asp-for="FpNumeroCaja" type="number" id="NumComp" />
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpNumFactCair" class="control-label" style="font-family:'Comic Sans MS';">Número de factura</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpNumFactCair" class="form-control" />
                    <span asp-validation-for="FpNumFactCair" class="text-danger"></span>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpIdprov" class="control-label" style="font-family:'Comic Sans MS';">Nombre de proveedor</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <select style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpIdprov" class="form-control" asp-items="ViewBag.FpIdprov"></select>
                </div>
            </div>
        </div>
        <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label asp-for="FpTipoMoneda" class="control-label" style="font-family:'Comic Sans MS';">Moneda</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    @*<input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpTipoMoneda" class="form-control" />*@
                    <select style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;"
                            asp-for="FpTipoMoneda" class="form-control" onchange="OcultaCampos();" id="DDLTP">
                        <option value="N/A">Seleccione</option>
                        <option value="MXN">PESO</option>
                        <option value="DLS">DOLAR</option>
                    </select>
                    <span asp-validation-for="FpTipoMoneda" class="text-danger"></span>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Sub total</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           id="txtSubtotal" asp-for="FpSubtotal" onchange="CalculaCampos();" />
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Maniobras/Cruce/Cacetas etc.</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           id="txtCargoExtra" asp-for="FpCargoExtra" onchange="CalculaCampos();" />
                </div>
            </div>
        </div>
        <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';" id="lbliva">IVA</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           id="txtiva" asp-for="FpIva" readonly="readonly" />
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';" id="lblretencion">Retención</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           id="txtretencion" asp-for="FpRetencion" readonly="readonly" />
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Costo total</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           readonly="readonly" id="txtCostoTotal" asp-for="FpCostoTotal" />
                </div>
            </div>
        </div>
        <div class="row" style="justify-content: center; justify-items: center; align-items: center; align-content: center;">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';" id="lbliva">Referencia</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           id="txtiva" asp-for="FpReferencia" />
                    @*<textarea style="width:100%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                        id="txtiva" asp-for="FpReferencia"></textarea>*@
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Forma de pago</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    @*<input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpFormaPago" class="form-control" />*@
                    <select style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpFormaPago" class="form-control">
                        <option value="N/A">Seleccione</option>
                        <option value="PPD">PPD</option>
                        <option value="PUE">PUE</option>
                    </select>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Estatus</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    @*<input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpEstatus" class="form-control" />*@
                    <select style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" asp-for="FpEstatus" id="EstatusPago" onchange="EstatusPagado()" class="form-control">
                        <option value="NO">NO PAGADO</option>
                        <option value="SI">PAGADO</option>
                        @*<option value="C">CANCELADO</option>*@
                    </select>
                </div>
            </div>
        </div>
        <div class="row" style="justify-content: center; justify-items: center; align-items: center; align-content: center; visibility: hidden;" id="divEstatus">
            <div class="col-lg-3 col-md-4 col-sm-6 form-group">
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <label class="control-label" style="font-family:'Comic Sans MS';">Fecha de pago</label>
                </div>
                <div class="row" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
                    <input style="width:80%; justify-content:center; justify-items:center; align-items:center; align-content:center;" class="form-control"
                           asp-format="{0:dd/MM/yyyy}" type="date" asp-for="FpFechaPago" id="DtePago" />
                    <span asp-validation-for="FpFechaPago" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row form-group" style="justify-content:center; justify-items:center; align-items:center; align-content:center">
            <input type="submit" value="Guardar Pago" class="btn btn-outline-success" asp-action="Create" style="font-family:'Comic Sans MS'" />
        </div>
        <script type="text/javascript">

            function EstatusPagado() {
                var Estatus = document.getElementById("EstatusPago").value;
                console.log("Estatus", Estatus);
                if (Estatus == "NO" || Estatus == "C") {
                    document.getElementById("divEstatus").style.visibility = "hidden";
                } else {
                    document.getElementById("divEstatus").style.visibility = "visible";
                }

            }
            function CalculaCampos() {
                try {
                    console.log("calcula campos...");
                    //txtCargoExtra
                    var CargoExt = document.getElementById("txtCargoExtra").value;
                    console.log("cargo extra", CargoExt);
                    if (CargoExt === null || CargoExt == "") {
                        CargoExt = 0;
                        console.log("cargo extra", CargoExt);
                    }
                    var subt = document.getElementById("txtSubtotal").value;
                    var TipoMoneda = document.getElementById("DDLTP").value;
                    console.log("Tipo de moneda: ", TipoMoneda);
                    if (TipoMoneda == "DOLAR" || TipoMoneda == "DLS") {
                        document.getElementById("txtiva").value = 0;
                        document.getElementById("txtretencion").value = 0;
                        document.getElementById("txtCostoTotal").value = parseFloat(parseFloat(subt) + parseFloat(CargoExt));
                    } else if ((TipoMoneda == "PESO" || TipoMoneda == "MXN") && subt != "") {
                        subt = parseFloat(parseFloat(subt) + parseFloat(CargoExt));
                        document.getElementById("txtiva").value = parseFloat(subt * 0.04);
                        document.getElementById("txtretencion").value = parseFloat(subt * 0.16);
                        var iva = parseFloat(document.getElementById("txtiva").value);
                        var retencion = parseFloat(document.getElementById("txtretencion").value);
                        var TipoMoneda = document.getElementById("DDLTP").value;
                        document.getElementById("txtCostoTotal").value = parseFloat(parseFloat(subt) + parseFloat(iva) + parseFloat(retencion));
                    }
                    else {
                        subt = parseFloat(parseFloat(subt) + parseFloat(CargoExt));
                        document.getElementById("txtiva").value = parseFloat(subt * 0.04);
                        document.getElementById("txtretencion").value = parseFloat(subt * 0.16);
                        var iva = parseFloat(document.getElementById("txtiva").value);
                        var retencion = parseFloat(document.getElementById("txtretencion").value);
                        var TipoMoneda = document.getElementById("DDLTP").value;
                        document.getElementById("txtCostoTotal").value = parseFloat(parseFloat(subt) + parseFloat(iva) + parseFloat(retencion));
                    }
                } catch (err) {
                    console.log("error: ", err);
                }
            }
            function OcultaCampos() {
                try {
                    console.log("Ocultando campos...");
                    var CargoExt = document.getElementById("txtCargoExtra").value;
                    console.log("cargo extra", CargoExt);
                    if (CargoExt === null || CargoExt == "") {
                        CargoExt = 0;
                        console.log("cargo extra", CargoExt);
                    }
                    var subt = document.getElementById("txtSubtotal").value;
                    var TipoMoneda = document.getElementById("DDLTP").value;
                    var lblSubt, iva, retencion, total;
                    if (TipoMoneda == "DOLAR" || TipoMoneda == "DLS") {
                        //document.getElementById("").value
                        document.getElementById("txtiva").style.visibility = "hidden";
                        document.getElementById("txtretencion").style.visibility = "hidden";
                        document.getElementById("lbliva").style.visibility = "hidden";
                        document.getElementById("lblretencion").style.visibility = "hidden";
                        document.getElementById("txtiva").value = 0
                        document.getElementById("txtretencion").value = 0
                        document.getElementById("txtCostoTotal").value = parseFloat(parseFloat(subt) + parseFloat(CargoExt)); //document.getElementById("txtSubtotal").value
                    } else if ((TipoMoneda == "PESO" || TipoMoneda == "MXN") && subt != "") {
                        //PONE LOS CAMPOS VISIBLES
                        document.getElementById("txtiva").style.visibility = "visible";
                        document.getElementById("txtretencion").style.visibility = "visible";
                        document.getElementById("lbliva").style.visibility = "visible";
                        document.getElementById("lblretencion").style.visibility = "visible";
                        //VUELVE A CALCULAR LOS PROSENTAJES
                        var subt = document.getElementById("txtSubtotal").value;
                        subt = parseFloat(parseFloat(subt) + parseFloat(CargoExt));
                        document.getElementById("txtiva").value = parseFloat(subt * 0.04);
                        document.getElementById("txtretencion").value = parseFloat(subt * 0.16);
                        var iva = parseFloat(document.getElementById("txtiva").value);
                        var retencion = parseFloat(document.getElementById("txtretencion").value);
                        document.getElementById("txtCostoTotal").value = parseFloat(parseFloat(subt) + parseFloat(iva) + parseFloat(retencion));
                    }
                } catch (err) {
                    console.log("error ocultacampos()", err);
                }
            }
        </script>
    </form>
</div>
@if (ViewBag.Action != "Correcto" & ViewBag.Action != null)
{
    <script>
            swal("Error!", "@TempData["ErrorCobroCliente"].ToString()", "error");
    </script>
    TempData["ErrorCobroCliente"] = null;
}
@if (ViewBag.Action == "Correcto")
{
    <script>
        swal("Correcto!", "Proceso terminado con exito", "success");
        //window.location.href = "../Clientes.cshtml";
        //window.location.reload();
        setTimeout(function () { window.location.href = "../PagoProveedores/Menu"; }, 2500);
    </script>

    ViewBag.Action = null;
}
<div>
    <a asp-action="Index" class="btn btn-outline-primary">Ir al catálogo de facturas</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}